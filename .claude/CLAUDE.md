# Pike LSP Project Guidelines

## MANDATORY: E2E Verification Before Commits

**DO NOT commit changes without verifying LSP functionality works end-to-end.**

Previous agents broke the LSP by:
1. Not testing with the actual VSCode extension
2. Not checking Pike bridge communication works
3. Not looking at debug/error output from Pike subprocess

### Verification Checklist

Before ANY commit affecting pike-scripts/ or packages/:

1. **Pike compiles**: `pike -e 'compile_file("pike-scripts/analyzer.pike");'`

2. **Bridge works**: Test that PikeBridge can call methods and get responses
   ```bash
   cd packages/pike-bridge && pnpm test
   ```

3. **LSP features work**: Document symbols, hover, go-to-definition return data (not null)
   - Open a .pike file in VSCode with the extension
   - Verify hover shows type info
   - Verify Outline view shows symbols

4. **Check stderr for errors**: Pike errors go to stderr, watch for them

### Quick Smoke Test

```bash
# This MUST return JSON with symbols, not timeout or error
echo '{"jsonrpc":"2.0","id":1,"method":"introspect","params":{"code":"int x;","filename":"test.pike"}}' \
  | timeout 5 pike pike-scripts/analyzer.pike 2>&1
```

## Architecture Overview

```
VSCode Extension (vscode-pike)
    |
    v
TypeScript LSP Server (pike-lsp-server)
    |
    v
PikeBridge (pike-bridge) -- JSON-RPC over stdin/stdout
    |
    v
Pike Analyzer (pike-scripts/analyzer.pike)
    |
    v
LSP Modules (LSP.pmod/*)
```

## Key Files

- `pike-scripts/analyzer.pike` - Pike subprocess entry point
- `pike-scripts/LSP.pmod/` - Pike LSP modules
- `packages/pike-bridge/` - TypeScript <-> Pike IPC
- `packages/pike-lsp-server/` - LSP protocol implementation
- `packages/vscode-pike/` - VSCode extension

<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Jan 20, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #4016 | 10:40 AM | ðŸŸ£ | GSD uncommitted planning mode enabled for pike-lsp project | ~204 |
</claude-mem-context>